# SPDX-FileCopyrightText: 2023 Maxwell G <gotmax@e.email>
#
# SPDX-License-Identifier: GPL-2.0-or-later

---
image: fedora/rawhide
packages:
  - podman
sources:
  - https://git.sr.ht/~gotmax23/fedrq
tasks:
  - c9s-test: |
      cd fedrq/
      cat <<- 'EOF' > test.sh
      dnf install -y createrepo_c rpm-build
      venv="venv"
      python3 -m venv "${venv}" --system-site-packages
      source "${venv}/bin/activate"
      pip install -U pip
      pip3 install '.[dev]' --use-pep517
      pytest -v
      mypy src/fedrq/
      EOF
      podman run -d -v $(pwd):/pwd:z -w /pwd --name c9ss centos:stream9 sleep infinity
      podman exec c9ss bash -xeu -o pipefail ./test.sh
