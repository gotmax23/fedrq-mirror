# SPDX-FileCopyrightText: 2022 Maxwell G <gotmax@e.email>
# SPDX-License-Identifier: GPL-2.0-or-later

---
image: fedora/rawhide
packages:
  - fedpkg
  - mock
  - mock-core-configs
  - rpmautospec
  - rpmdevtools
  - shadow-utils
  # fclogr dependency
  - python3-specfile
sources:
  - https://git.sr.ht/~gotmax23/fedrq
environment:
  RELEASE: rawhide
artifacts:
  - fedrq/results_fedrq.tar.gz
tasks:
  - setup-add-mock-group: |
      sudo usermod -aG mock $USER
  - build-rawhide: |
      python3 -m venv venv --system-site-packages
      . ./venv/bin/activate
      pip install 'git+https://git.sr.ht/~gotmax23/fclogr#main'
      cd fedrq
      fclogr --debug dev-entries --archive -r $(git describe --abbrev=0 HEAD)
      fedpkg --name fedrq --release "${RELEASE}" mockbuild --no-cleanup-after -- --verbose
      tar cvf results_fedrq.tar.gz results_fedrq
      fedpkg --verbose --name fedrq --release "${RELEASE}" lint --info
